
use deku::prelude::*;
use deku::ctx::ByteSize;
use serde::Serialize;
use crate::nas::layer3::*;

/// Autogenerated rust code, do not modify directly! Any changes should be
/// made via the python generator scripts.

#[derive(DekuRead, Debug, Serialize, Clone)]
pub struct EMMCPServiceRequest {
    pub nas_ksi: Type1V<NASKSI>,
    pub cp_service_type: Type1V<CPServiceType>,
    #[deku(ctx = "Tag(120), NeedsByteSize")] pub esm_container: Type6TLVE<Layer3Buffer>,
    #[deku(ctx = "Tag(103), NeedsByteSize")] pub nas_container: Type4TLV<Layer3Buffer>,
    #[deku(ctx = "Tag(87)")] pub eps_bearer_ctxt_stat: Type4TLV<EPSBearerCtxtStat>,
    #[deku(ctx = "Tag(13)")] pub device_prop: Type1TV<DeviceProp>,
}

#[derive(DekuRead, Debug, Serialize, Clone)]
pub struct NASKSI {
    pub tsc: NASKSITSC,
    pub value: NASKSIValue,
}

#[derive(DekuRead, Debug, Serialize, Clone)]
pub struct CPServiceType {
    pub active: CPServiceTypeActive,
    pub value: CPServiceTypeValue,
}

#[derive(DekuRead, Debug, Serialize, Clone)]
pub struct EPSBearerCtxtStat {
    pub ebi_7: EPSBearerCtxtStatEBI7,
    pub ebi_6: EPSBearerCtxtStatEBI6,
    pub ebi_5: EPSBearerCtxtStatEBI5,
    #[deku(bits = 1)] pub ebi_4: u8,
    #[deku(bits = 1)] pub ebi_3: u8,
    #[deku(bits = 1)] pub ebi_2: u8,
    #[deku(bits = 1)] pub ebi_1: u8,
    #[deku(bits = 1)] pub ebi_0: u8,
    pub ebi_15: EPSBearerCtxtStatEBI15,
    pub ebi_14: EPSBearerCtxtStatEBI14,
    pub ebi_13: EPSBearerCtxtStatEBI13,
    pub ebi_12: EPSBearerCtxtStatEBI12,
    pub ebi_11: EPSBearerCtxtStatEBI11,
    pub ebi_10: EPSBearerCtxtStatEBI10,
    pub ebi_9: EPSBearerCtxtStatEBI9,
    pub ebi_8: EPSBearerCtxtStatEBI8,
}

#[derive(DekuRead, Debug, Serialize, Clone)]
pub struct DeviceProp {
    #[deku(bits = 3)] pub spare: u8,
    #[deku(bits = 1)] pub low_priority: u8,
}
#[derive(DekuRead, Debug, Serialize, Clone, PartialEq)]
#[deku(id_type = "u8", bits = 1)]
pub enum EPSBearerCtxtStatEBI7 {
    #[deku(id_pat = "0")] BEARERCONTEXTINACTIVE,
    #[deku(id_pat = "1")] BEARERCONTEXTACTIVE,
    #[deku(id_pat = "_")] Other,
}

#[derive(DekuRead, Debug, Serialize, Clone, PartialEq)]
#[deku(id_type = "u8", bits = 1)]
pub enum EPSBearerCtxtStatEBI6 {
    #[deku(id_pat = "0")] BEARERCONTEXTINACTIVE,
    #[deku(id_pat = "1")] BEARERCONTEXTACTIVE,
    #[deku(id_pat = "_")] Other,
}

#[derive(DekuRead, Debug, Serialize, Clone, PartialEq)]
#[deku(id_type = "u8", bits = 1)]
pub enum EPSBearerCtxtStatEBI5 {
    #[deku(id_pat = "0")] BEARERCONTEXTINACTIVE,
    #[deku(id_pat = "1")] BEARERCONTEXTACTIVE,
    #[deku(id_pat = "_")] Other,
}

#[derive(DekuRead, Debug, Serialize, Clone, PartialEq)]
#[deku(id_type = "u8", bits = 1)]
pub enum EPSBearerCtxtStatEBI15 {
    #[deku(id_pat = "0")] BEARERCONTEXTINACTIVE,
    #[deku(id_pat = "1")] BEARERCONTEXTACTIVE,
    #[deku(id_pat = "_")] Other,
}

#[derive(DekuRead, Debug, Serialize, Clone, PartialEq)]
#[deku(id_type = "u8", bits = 1)]
pub enum EPSBearerCtxtStatEBI14 {
    #[deku(id_pat = "0")] BEARERCONTEXTINACTIVE,
    #[deku(id_pat = "1")] BEARERCONTEXTACTIVE,
    #[deku(id_pat = "_")] Other,
}

#[derive(DekuRead, Debug, Serialize, Clone, PartialEq)]
#[deku(id_type = "u8", bits = 1)]
pub enum EPSBearerCtxtStatEBI13 {
    #[deku(id_pat = "0")] BEARERCONTEXTINACTIVE,
    #[deku(id_pat = "1")] BEARERCONTEXTACTIVE,
    #[deku(id_pat = "_")] Other,
}

#[derive(DekuRead, Debug, Serialize, Clone, PartialEq)]
#[deku(id_type = "u8", bits = 1)]
pub enum EPSBearerCtxtStatEBI12 {
    #[deku(id_pat = "0")] BEARERCONTEXTINACTIVE,
    #[deku(id_pat = "1")] BEARERCONTEXTACTIVE,
    #[deku(id_pat = "_")] Other,
}

#[derive(DekuRead, Debug, Serialize, Clone, PartialEq)]
#[deku(id_type = "u8", bits = 1)]
pub enum EPSBearerCtxtStatEBI11 {
    #[deku(id_pat = "0")] BEARERCONTEXTINACTIVE,
    #[deku(id_pat = "1")] BEARERCONTEXTACTIVE,
    #[deku(id_pat = "_")] Other,
}

#[derive(DekuRead, Debug, Serialize, Clone, PartialEq)]
#[deku(id_type = "u8", bits = 1)]
pub enum EPSBearerCtxtStatEBI10 {
    #[deku(id_pat = "0")] BEARERCONTEXTINACTIVE,
    #[deku(id_pat = "1")] BEARERCONTEXTACTIVE,
    #[deku(id_pat = "_")] Other,
}

#[derive(DekuRead, Debug, Serialize, Clone, PartialEq)]
#[deku(id_type = "u8", bits = 1)]
pub enum EPSBearerCtxtStatEBI9 {
    #[deku(id_pat = "0")] BEARERCONTEXTINACTIVE,
    #[deku(id_pat = "1")] BEARERCONTEXTACTIVE,
    #[deku(id_pat = "_")] Other,
}

#[derive(DekuRead, Debug, Serialize, Clone, PartialEq)]
#[deku(id_type = "u8", bits = 1)]
pub enum EPSBearerCtxtStatEBI8 {
    #[deku(id_pat = "0")] BEARERCONTEXTINACTIVE,
    #[deku(id_pat = "1")] BEARERCONTEXTACTIVE,
    #[deku(id_pat = "_")] Other,
}

#[derive(DekuRead, Debug, Serialize, Clone, PartialEq)]
#[deku(id_type = "u8", bits = 1)]
pub enum CPServiceTypeActive {
    #[deku(id_pat = "0")] NoBearerEstablishmentRequested,
    #[deku(id_pat = "1")] BearerEstablishmentRequested,
    #[deku(id_pat = "_")] Other,
}

#[derive(DekuRead, Debug, Serialize, Clone, PartialEq)]
#[deku(id_type = "u8", bits = 3)]
pub enum CPServiceTypeValue {
    #[deku(id_pat = "0")] MobileOriginatingRequest,
    #[deku(id_pat = "1")] MobileTerminatingRequest,
    #[deku(id_pat = "_")] Other,
}

#[derive(DekuRead, Debug, Serialize, Clone, PartialEq)]
#[deku(id_type = "u8", bits = 1)]
pub enum NASKSITSC {
    #[deku(id_pat = "0")] NativeSecurityContext,
    #[deku(id_pat = "1")] MappedSecurityContext,
    #[deku(id_pat = "_")] Other,
}

#[derive(DekuRead, Debug, Serialize, Clone, PartialEq)]
#[deku(id_type = "u8", bits = 3)]
pub enum NASKSIValue {
    #[deku(id_pat = "7")] NoKeyAvailable,
    #[deku(id_pat = "_")] Other,
}

#[cfg(test)]
mod tests {
    use super::*;
    use crate::nas::test_utils::*;
    use deku::prelude::*;
    use std::io::Cursor;

    #[test]
    fn test_case_1() {
        let mut bytes = Cursor::new(unhexlify("707800040200e86f6703091011570233c9d1"));
        let mut reader = Reader::new(&mut bytes);
        let msg = EMMCPServiceRequest::from_reader_with_ctx(&mut reader, ())
            .expect("failed to parse");
        let nas_ksi = msg.nas_ksi.inner;
        assert_eq!(nas_ksi.tsc, NASKSITSC::NativeSecurityContext);
        assert_eq!(nas_ksi.value, NASKSIValue::NoKeyAvailable);
        let cp_service_type = msg.cp_service_type.inner;
        assert_eq!(cp_service_type.active, CPServiceTypeActive::NoBearerEstablishmentRequested);
        assert_eq!(cp_service_type.value, CPServiceTypeValue::MobileOriginatingRequest);
        let esm_container = msg.esm_container.inner.unwrap();
        assert_eq!(esm_container, vec![2, 0, 232, 111]);
        let nas_container = msg.nas_container.inner.unwrap();
        assert_eq!(nas_container, vec![9, 16, 17]);
        let eps_bearer_ctxt_stat = msg.eps_bearer_ctxt_stat.inner.unwrap();
        assert_eq!(eps_bearer_ctxt_stat.ebi_7, EPSBearerCtxtStatEBI7::BEARERCONTEXTINACTIVE);
        assert_eq!(eps_bearer_ctxt_stat.ebi_6, EPSBearerCtxtStatEBI6::BEARERCONTEXTINACTIVE);
        assert_eq!(eps_bearer_ctxt_stat.ebi_5, EPSBearerCtxtStatEBI5::BEARERCONTEXTACTIVE);
        assert_eq!(eps_bearer_ctxt_stat.ebi_4, 1);
        assert_eq!(eps_bearer_ctxt_stat.ebi_3, 0);
        assert_eq!(eps_bearer_ctxt_stat.ebi_2, 0);
        assert_eq!(eps_bearer_ctxt_stat.ebi_1, 1);
        assert_eq!(eps_bearer_ctxt_stat.ebi_0, 1);
        assert_eq!(eps_bearer_ctxt_stat.ebi_15, EPSBearerCtxtStatEBI15::BEARERCONTEXTACTIVE);
        assert_eq!(eps_bearer_ctxt_stat.ebi_14, EPSBearerCtxtStatEBI14::BEARERCONTEXTACTIVE);
        assert_eq!(eps_bearer_ctxt_stat.ebi_13, EPSBearerCtxtStatEBI13::BEARERCONTEXTINACTIVE);
        assert_eq!(eps_bearer_ctxt_stat.ebi_12, EPSBearerCtxtStatEBI12::BEARERCONTEXTINACTIVE);
        assert_eq!(eps_bearer_ctxt_stat.ebi_11, EPSBearerCtxtStatEBI11::BEARERCONTEXTACTIVE);
        assert_eq!(eps_bearer_ctxt_stat.ebi_10, EPSBearerCtxtStatEBI10::BEARERCONTEXTINACTIVE);
        assert_eq!(eps_bearer_ctxt_stat.ebi_9, EPSBearerCtxtStatEBI9::BEARERCONTEXTINACTIVE);
        assert_eq!(eps_bearer_ctxt_stat.ebi_8, EPSBearerCtxtStatEBI8::BEARERCONTEXTACTIVE);
        let device_prop = msg.device_prop.inner.unwrap();
        assert_eq!(device_prop.low_priority, 1);
    }
}

